
**BitRat
**





Covering the Bitrat malware.

Off the bat, the executable MDF hash: 13e0f258cfbe3aece8a7e6d29ceb5697

Almost forgot, because the malware can only .Net dependencies. This can only be run on Windows(unsure on if 7-11?)

General coverage

RAT | Data theft(how so) | Ability to survey(in memory or disk?) | off-the-shelf(good(low success rate and bad(some modifications could make it annoying for defenders) )

Multiple capabilities that offer script kiddys plenty of ability to reek havoc. 

Delivered in the following methods:
- Email(https://medium.com/@justinmangaoang/cyber-defenders-phishstrike-lab-write-up-ae2f4e9df6eb - first part explains the deficne for this)
- Cracked Software(yikes)
 

Mitre Attack

TA0004(Privilege Escalation)
TA0005(Defensive Evasion)
TA0007(Discovery)
TA0011(Command and Control)


Priv ESC
T1055(Spwans Process)

Another case of DLL injection within legitimate processes already trusted on the machine.
Proccesses in question. All legitimate processes it hijnacks to launch malicious payload.
- LoadLibrary
- CreateRemoteThread
Something called "Process Hallowing"
Creating a legitimate process after the hijack, placing that process in a suspended state. Then replacing
the original process memory and replaces it within the payload.

Why and How: I was thinking about how it is able to just act on the computer. Prompt on how it is able to do so is a follows:

- Running as Admin(fake installers, UAC bypass, social engineering)
- Exploiting vulnerabiliteas
- Abusing Token Impersonation(steal and duplicate security tokens)
- Disabling Security Controls(sounds like an attempt) 


Ta0005(Defensive Evasion)
^ When having hands on whether able to analyze and break part a malware
example. Defense should be looked at carefully. 



T1027 & TA1027.002
 Obfuscated Files and Packing
Some reports say that this is true and false.

Some run through a decryer and say they have issue. 

This may depend on how the attacker 

In general binaries and config files are obfuscated(packed or encrypted)

Including dynamically unpacking itself at runtime

Why 

Uses string encryption and XOR-based obfuscation to hide key functions.
Employs run-time unpacking where the packed loader decrypts the actual RAT payload in memory(ram).
Uses .NET-based packers to make reverse engineering difficult.

T1055
Injects itself in legitimate process
- explorer.exe
- svchost.exe

Virtualization avoidance

Checks if its running in a virtual environment

How (Prompt)
Detects Debuggers: Calls 
- IsDebuggerPresent() 
- NtQueryInformationProcess().
^^^I wonder if removing these is that simple.

Checks VM Artifacts: Looks for common virtual machine files, drivers, and registry keys (e.g., VMWare, VirtualBox).
Detects Sandboxes:  
- GetTickCount()  
- RDTSC (timestamp counter)
Sleeps to Avoid Analysis: Uses long sleep cycles (Sleep(300000)) to delay execution in sandbox environments.


Impair defenses (T1562 & T1562.001)
Attempts
- Disable EDR
- Modify Firewall rules 

How and the code that it tries:

- Disables vie registry modification 

reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /v "DisableAntiSpyware" /t REG_DWORD /d "1" /f

- Windows Defender Services

sc stop WinDefend
sc config WinDefend start= disabled

- Deletes security logs

wevtutil cl System
wevtutil cl Security

Disables Firewall rules to allow passage to C2 server 

netsh advfirewall set allprofiles state off


TA007


T1012(Query Registry)

Checks to monmitor AutoStart resistry keys and maintain persistence

- Example code for how it does so
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run"


T1018(Remote System Discovery)

Looks for networked systems by reading host files. 

- Code like 

type C:\Windows\System32\drivers\etc\hosts 

&

net view /all


T1082(System Information Discovery)

Colects hardware and system data(cpu, guid's. hardware models)

- PS
MAchine GUID
reg query "HKLM\SOFTWARE\Microsoft\Cryptography" /v MachineGuid

Volume serial numbers
wmic diskdrive get serialnumber


Software policies and system settings

reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows"


T1518 & T1518.001(Software Discovery) 


General EDR detection


Command and Control

T1071(Application Layer protocol)



This all rlates to the C2 infra that is setup after inital access and modification has been done

This includes
- DNS
- HTTPS(note the encryption)




Example of how Bitrat gained the following
- Intal access(also evading detection)
- Installed (again while also evading detection)


In the banks case, malicious excel files were dropped off that did the following.
- Objuscated MAcors
- INF(Setup Information) file is a plain text file used by Windows to install software, drivers, or system configurations.) Payload segmented within the macro
- Rebuilding the INF payload using math
- Writes the Payload to Temp and Executes It via ADVPACK.DLL

***
This .inf file should be looked into more. Seems like it can be abused and modified for fun for beginners. 
***






Covering the Bitrat malware.

Off the bat, the executable MDF hash: 13e0f258cfbe3aece8a7e6d29ceb5697

Almost forgot, because the malware can only .Net dependencies. This can only be run on Windows(unsure on if 7-11?)

General coverage

RAT | Data theft(how so) | Ability to survey(in memory or disk?) | off-the-shelf(good(low success rate and bad(some modifications could make it annoying for defenders) )

Multiple capabilities that offer script kiddys plenty of ability to reek havoc. 

Delivered in the following methods:
- Email(https://medium.com/@justinmangaoang/cyber-defenders-phishstrike-lab-write-up-ae2f4e9df6eb - first part explains the deficne for this)
- Cracked Software(yikes)
 

Mitre Attack

TA0004(Privilege Escalation)
TA0005(Defensive Evasion)
TA0007(Discovery)
TA0011(Command and Control)


Priv ESC
T1055(Spwans Process)

Another case of DLL injection within legitimate processes already trusted on the machine.
Proccesses in question. All legitimate processes it hijnacks to launch malicious payload.
- LoadLibrary
- CreateRemoteThread
Something called "Process Hallowing"
Creating a legitimate process after the hijack, placing that process in a suspended state. Then replacing
the original process memory and replaces it within the payload.

Why and How: I was thinking about how it is able to just act on the computer. Prompt on how it is able to do so is a follows:

- Running as Admin(fake installers, UAC bypass, social engineering)
- Exploiting vulnerabiliteas
- Abusing Token Impersonation(steal and duplicate security tokens)
- Disabling Security Controls(sounds like an attempt) 


Ta0005(Defensive Evasion)
^ When having hands on whether able to analyze and break part a malware
example. Defense should be looked at carefully. 



T1027 & TA1027.002
 Obfuscated Files and Packing
Some reports say that this is true and false.

Some run through a decryer and say they have issue. 

This may depend on how the attacker 

In general binaries and config files are obfuscated(packed or encrypted)

Including dynamically unpacking itself at runtime

Why 

Uses string encryption and XOR-based obfuscation to hide key functions.
Employs run-time unpacking where the packed loader decrypts the actual RAT payload in memory(ram).
Uses .NET-based packers to make reverse engineering difficult.

T1055
Injects itself in legitimate process
- explorer.exe
- svchost.exe

Virtualization avoidance

Checks if its running in a virtual environment

How (Prompt)
Detects Debuggers: Calls 
- IsDebuggerPresent() 
- NtQueryInformationProcess().
^^^I wonder if removing these is that simple.

Checks VM Artifacts: Looks for common virtual machine files, drivers, and registry keys (e.g., VMWare, VirtualBox).
Detects Sandboxes:  
- GetTickCount()  
- RDTSC (timestamp counter)
Sleeps to Avoid Analysis: Uses long sleep cycles (Sleep(300000)) to delay execution in sandbox environments.


Impair defenses (T1562 & T1562.001)
Attempts
- Disable EDR
- Modify Firewall rules 

How and the code that it tries:

- Disables vie registry modification 

reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /v "DisableAntiSpyware" /t REG_DWORD /d "1" /f

- Windows Defender Services

sc stop WinDefend
sc config WinDefend start= disabled

- Deletes security logs

wevtutil cl System
wevtutil cl Security

Disables Firewall rules to allow passage to C2 server 

netsh advfirewall set allprofiles state off


TA007


T1012(Query Registry)

Checks to monmitor AutoStart resistry keys and maintain persistence

- Example code for how it does so
reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Run"


T1018(Remote System Discovery)

Looks for networked systems by reading host files. 

- Code like 

type C:\Windows\System32\drivers\etc\hosts 

&

net view /all


T1082(System Information Discovery)

Colects hardware and system data(cpu, guid's. hardware models)

- PS
MAchine GUID
reg query "HKLM\SOFTWARE\Microsoft\Cryptography" /v MachineGuid

Volume serial numbers
wmic diskdrive get serialnumber


Software policies and system settings

reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows"


T1518 & T1518.001(Software Discovery) 


General EDR detection


Command and Control

T1071(Application Layer protocol)



This all rlates to the C2 infra that is setup after inital access and modification has been done

This includes
- DNS
- HTTPS(note the encryption)




Example of how Bitrat gained the following
- Intal access(also evading detection)
- Installed (again while also evading detection)


In the banks case, malicious excel files were dropped off that did the following.
- Objuscated MAcors
- INF(Setup Information) file is a plain text file used by Windows to install software, drivers, or system configurations.) Payload segmented within the macro
- Rebuilding the INF payload using math
- Writes the Payload to Temp and Executes It via ADVPACK.DLL

***
This .inf file should be looked into more. Seems like it can be abused and modified for fun for beginners. 
***





